# 附录：渲染树参数

我们的RT Blender插件基于著名的Sapling Tree Gen。通过RT插件用于重建3D树的参数可以分为五类：几何、树干半径、树干分支、树干生长和叶子。虽然还有其他类别，如修剪、骨架和动画，但我们没有描述它们的参数，因为我们不考虑这些值用于我们的树，对于那些强制值，我们将它们设置为默认值。

## 几何

这个类别表示定义树的一般几何形状和详细级别（LOD）的参数。

-   **斜角分辨率**：控制树的表面平滑度；

-   **控制点类型**：表示曲线点的类型（我们使用默认值*auto*）；

-   **形状**：通过选择$9$个之一，圆锥形、反圆锥形、圆柱形、球形，设置树的基本形状。还有第十个值，它激活**customShape**参数，由$4$个值组成，每个树级别一个，树干，第一层枝干，第二层和第三层，如<a href="#tree_levels">图1</a>所示。每个值表示每个级别的组成部分的长度；
    | <img src="imgs/01_tree_levels.png" name="tree_levels" alt="Tree Levels" style="width:50%"> | 
    |:--:| 
    | *图1 - 用4个customShape值设置树组成部分的长度。级别0表示树干长度，级别1表示第一层枝干长度，级别2表示第二层枝干长度，级别3表示第四层枝干长度* |

-   **次级分支**：改变次级分支的样式；

-   **树干分布**：根据其值将分支聚集在树干的基部或顶部，定义分支的分布；

-   **分支环数（分支螺旋数）**：将分支放置在树干周围，形成环状，还提供环数（松树）；

-   **随机种子**：用于生成相同类型的树；

-   **缩放**和**缩放变化**：定义树的基本高度。

## 树干半径

这个类别包含有用于定义树干半径的参数。

-   **比率**：是分支厚度的基础值。

-   **半径缩放**（scale0）和**半径缩放变化**（scaleV0）：定义树干半径缩放及其变化范围。
    $$radius_{trunk} = length_{trunk} * ratio * (scale0 \pm scaleV0)$$ 
    其中：$radius_{trunk}$是树干半径，$length_{trunk}$是树干长度；

-   **分支半径比率**（ratioPower）：定义下一级分支的厚度值如下：
    $$radius_{child}=radius_{parent}\left(\frac{length_{child}}{length_{parent}}\right)^{ratioPower}$$ 
    其中：$radius_{child}$是上一级分支的半径，$radius_{parent}$是下一级分支的半径，$length_{child}$是上一级分支的长度，$length_{parent}$是下一级分支的长度；

-   **最小半径**：是最细分支允许的最小半径值；

-   **关闭尖端**：如果选择，关闭分支的尖端；

-   **根膨胀**：在树的基部创建一个圆锥形状；

-   **锥度**：对于每个级别都包含一个值，用于定义分支尖端的厚度；

-   **微调半径**：对于每个级别都包含一个值，该值与分支半径比率相乘，以对分支的厚度进行主要控制。

## 分支分裂

这个类别包含分支参数的分裂。每个级别的分支可以分裂或克隆为与起始分支相同级别的其他分支，如<a href="#02_segSplits_splitAngle">图2</a>所示。

| <img src="imgs/02_segSplits_splitAngle.png" name="02_segSplits_splitAngle" alt="SegSplit SplitAngle" style="width:50%"> | 
|:--:| 
| *图2 - 分支分裂示例* |

-   **级别数**：表示分支级别的数量，当$levels=2$时，将生成一个树，包括树干和第一层分支；

-   **基本分裂（树叉）**：和段分裂（稍后描述）影响树干的分裂；

-   **树干高度（冠底高度）**：指示从树干高度百分比开始放置分支；

-   **次级基底大小**：减小每个级别的基底尺寸；

-   **分裂高度**：定义树中没有细分的高度阈值；

-   **分裂偏差**：通过将它们聚集在树的顶部或底部改变分裂分布；

-   **分支数**：每个级别的分支数；

-   **段分裂**（segSplits）：每个分支段的分裂数。当$segSplits = 0.0$时，没有分裂，当$segSplits = 1.0$时，分

支二分裂，当$segSplits = 2.0$时，分支分为三部分，以此类推，最大值为$3$；

-   **分裂角度（兄弟角度）**和**分裂变化（兄弟角度变化）**：表示角度的幅度及其变化；
  
-   **旋转角度（分支旋转角度）**和**旋转变化（分支旋转角度变化）**：表示生长方向的角度及其变化，如<a href="#03_rotate_rotateV">图3</a>所示；

-   **分支旋转**：表示分支旋转矩阵的分支旋转角度，其中还定义了旋转轴。

-   **最后旋转角度（父分支旋转角度）**：是最后一个父旋转，它与当前分支旋转相加，以得到分支旋转参数。
    
    | <img src="imgs/03_rotate_rotateV.png" name="03_rotate_rotateV" alt="Rotate" style="width:50%"> | <img src="imgs/04_curveRes.png" name="04_curveRes" alt="curveRes" style="width:50%">| 
    |:--:|:--:|
    | *图3 - 分支旋转* | *图4 - 曲线分辨率* |

-   **向外吸引**：使分支向外弯曲；

-   **分支模式**：均匀分布分支，允许它们指向外部，从分支中心开始，或从树中心开始，或随机；

-   **曲线分辨率**：定义每个分支的段数。增加此值可以获得更加曲线的分支（见<a href="#04_curveRes">图4</a>）。

-   **符号**：定义通过合并分裂角度和分裂角度变化获得的角度的符号。

## 分支生长

这个类别包含设置树枝生长的参数（见<a href="#05_downAngle">图5</a>）。

| <img src="imgs/05_downAngle.png" name="05_downAngle" alt="Branches Growth" style="width:50%"> | 
|:--:| 
| *图5 - 树枝生长* |

-   **锥度冠**：减小树干的尺寸及其相应的细分；

-   **长度**和**长度变化**：分别确定每个级别的分支长度和变化范围；

-   **向下角度**（downAngle）和**向下角度变化（父分支角度变化）**：使分支后退，增加它与它生长的分支（父分支）之间的角度的幅度；

-   **曲率（第一半国际节分枝角度）**和**曲率变化（国际节分枝角度变化）**：用于使分支后退，将其向内弯曲；

-   **背部曲率（第二半国际节分枝角度）**：弯曲分支的尖端；

-   **垂直吸引（重力弯曲强度）**：将分支朝向地面拉；

-   **使用旧的向下角度变化**：如果选择，它将使用上一个分支（父分支）的downAngle参数；

-   **使用父级角度**：如果选择，它会旋转分支以与前一个分支匹配。

## 叶子

这个类别包含设置树叶的参数。树的冠可以根据需要启用或禁用（见<a href="#06_leaf_horizontal">图6</a>）。

| <img src="imgs/06_leaf_horizontal.png" name="06_leaf_horizontal" alt="leaf Horizontal" style="width:50%"> | 
|:--:| 
| *图6 - 树冠设置参数* |

-   **叶片形状**：设置叶片形状，可以是矩形、六边形、dupliface或duplivert；

-   **叶子**：确定每个分支的叶子数量；

-   **叶子分布**：指示叶子的分布类型；

-   **叶下角度**和**叶下角度变化**：使叶子后退，增加它与生长它的分支（父分支）之间的角度的幅度；

-   **叶片旋转（叶片旋转角度）**和**叶片旋转变化（叶片角度变化）**：是叶子的方向生长角度及其变化；

-   **叶片比例（叶片缩放因子）**和**叶片比例变化（叶片缩放因子变化）**：确定叶片的比例及其变化范围；

-   **叶片比例X**：沿X轴缩放叶片；

-   **叶片比例锥度**：沿着它们生长的分支的尖端或基部缩放叶片；

-   **水平叶片**：如果启用，则叶片向上翻转；

-   **叶片角度**：将叶片朝向地面。